<!DOCTYPE html>
<html>
<head>
    <title>Shaka Player</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.9.3/controls.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.8.8/shaka-player.ui.min.js"></script>
    <script src="channelData.js"></script> <!-- Adjust the path to match your setup -->
</head>
<body style="margin:0; background:black;">

<center>
    <div data-shaka-player-container style="width: 100%; height: 100%;" class="shaka-video-container">
        <video id="video" class="shaka-video" autoplay style="width: 100%; height: 100%;"></video>
    </div>
</center>

<script>
    // Function to fetch query parameters from the URL
    function getQueryParameter(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    function initPlayer() {
        const channelId = getQueryParameter('id'); // Fetch channel name from URL parameter
        const selectedChannel = channelData[channelId]; // Match channel data from channelData.js

        if (!selectedChannel) {
            console.error('Channel not found in channelData');
            alert('Invalid channel ID!');
            return;
        }

        const video = document.getElementById('video');
        const ui = video['ui'];
        const controls = ui.getControls();
        const player = controls.getPlayer();

        // Configure the player
        const config = {
            controlPanelElements: ['play_pause', 'time_and_duration', 'spacer', 'mute', 'fullscreen'],
            playbackRates: [0.5, 1, 1.5, 2],
        };
        ui.configure(config);

        // DRM and manifest file setup
        player.configure({
            drm: {
                clearKeys: {
                    [selectedChannel.drm.clearkey.keyId]: selectedChannel.drm.clearkey.key
                }
            }
        });

        // Load the manifest file
        player.load(selectedChannel.file).then(() => {
            console.log('The video has been loaded successfully!');
        }).catch((error) => {
            console.error('Error loading video:', error);
        });
    }

    // Initialize player after Shaka UI loads
    document.addEventListener('shaka-ui-loaded', initPlayer);
</script>

</body>
</html>
